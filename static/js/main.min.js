app=angular.module("airdate",[]).controller("mainController",["$scope","$http","$location",function(s,e,o){function n(s){e.get("http://api.tvmaze.com/shows/"+s.id+"/episodes?").success(function(e){for(i=0;i<e.length;i++){var o={},n=new Date(e[i].airstamp),r=new Date;o.airdate=n.getMonth()+"."+n.getDate()+"."+n.getFullYear().toString().substring(2,4),o.airtime=n.toTimeString().substring(0,5),o.name=e[i].name,o.season=e[i].season,o.runtime=e[i].runtime,o.summary=e[i].summary.substring(3,e[i].summary.length-4),e[i].number<10?o.epInSeason="0"+e[i].number:o.epInSeason=e[i].number,n>r?s.upcomingEpisodes.push(o):s.pastEpisodes.push(o),o=""}return t(s),s}).error(function(s){console.log(s)})}function t(s){if(s.upcomingEpisodes.length>0)var e=s.upcomingEpisodes[s.upcomingEpisodes.length-1];else var e=s.pastEpisodes[s.pastEpisodes.length-1];var o=e.season;for(j=0;j<o;j++)s.seasons.push([]);for(p=0;p<s.pastEpisodes.length;p++)for(i=0;i<=o;i++)s.pastEpisodes[p].season==i+1&&s.seasons[i].push(s.pastEpisodes[p]);return s}s.searchResults=[],s.userShows=[],s.searching=!1,s.selectedSeason=-1,s.toggle=!1,s.showLogin=!1,s.showSignup=!1,s.popupText="",s.showLogin?s.showSignup=!1:s.showSignup&&(s.showLogin=!1),o.search().login?s.showLogin=!0:o.search().signup&&(s.showSignup=!0),e.get("/api/shows").success(function(e){for(var o=0;o<e.length;o++){var i=e[o];i.upcomingEpisodes=[],i.pastEpisodes=[],i.seasons=[],n(i),s.userShows.push(i)}console.log(s.userShows)}).error(function(s){console.log(s)}),s.search=function(){s.searching=!0,e.get("http://api.tvmaze.com/search/shows?q="+s.searchTerm).success(function(e){s.searching=!1,s.searchResults=e}).error(function(e){s.searching=!1})},s.select=function(o,i,t){s.searching=!0,s.searchTerm="";var r={};r.upcomingEpisodes=[],r.pastEpisodes=[],r.seasons=[],r.name=o,r.id=i,r.started=t.substring(0,4),n(r),s.userShows.push(r),e.post("/addShow",{show:r}),r=""},s.deleteShow=function(o){var n=s.userShows.indexOf(o);console.log(o.id),n>-1&&(s.userShows.splice(n,1),e.post("/rmShow",{showId:o.id}))},s.deleteAccount=function(){e.post("/rmUser")},s.selectSeason=function(e){s.selectedSeason=e}}]).directive("toggleClass",function(){return{restrict:"A",link:function(s,e,o){e.bind("click",function(){e.toggleClass(o.toggleClass)})}}});