app=angular.module("airdate",[]).controller("mainController",["$scope","$http","$location",function(s,e,n){function o(s){e.get("http://api.tvmaze.com/shows/"+s.id+"/episodes?").success(function(e){for(i=0;i<e.length;i++){var n={},o=new Date(e[i].airstamp),r=new Date;n.airdate=o.getMonth()+"."+o.getDate()+"."+o.getFullYear().toString().substring(2,4),n.airtime=o.toTimeString().substring(0,5),n.name=e[i].name,n.season=e[i].season,n.runtime=e[i].runtime,n.summary=e[i].summary.substring(3,e[i].summary.length-4),e[i].number<10?n.epInSeason="0"+e[i].number:n.epInSeason=e[i].number,o>r?s.upcomingEpisodes.push(n):s.pastEpisodes.push(n),n=""}return t(s),s}).error(function(s){console.log(s)})}function t(s){if(s.upcomingEpisodes.length>0)var e=s.upcomingEpisodes[s.upcomingEpisodes.length-1];else var e=s.pastEpisodes[s.pastEpisodes.length-1];var n=e.season;for(j=0;j<n;j++)s.seasons.push([]);for(p=0;p<s.pastEpisodes.length;p++)for(i=0;i<=n;i++)s.pastEpisodes[p].season==i+1&&s.seasons[i].push(s.pastEpisodes[p]);return s}s.searchResults=[],s.userShows=[],s.searching=!1,s.selectedSeason=-1,s.toggle=!1,s.showLogin=!1,n.search().login&&(s.showLogin=!0),s.search=function(){s.searching=!0,e.get("http://api.tvmaze.com/search/shows?q="+s.searchTerm).success(function(e){s.searching=!1,s.searchResults=e}).error(function(e){s.searching=!1})},s.select=function(e,n,i){s.searching=!0,s.searchTerm="";var t={};t.upcomingEpisodes=[],t.pastEpisodes=[],t.seasons=[],t.name=e,t.id=n,t.started=i.substring(0,4),o(t),s.userShows.push(t),console.log(s.userShows),t=""},s.deleteShow=function(e){var n=s.userShows.indexOf(e);n>-1&&s.userShows.splice(n,1)},s.selectSeason=function(e){s.selectedSeason=e}}]).directive("toggleClass",function(){return{restrict:"A",link:function(s,e,n){e.bind("click",function(){e.toggleClass(n.toggleClass)})}}});